<p align="center">
    <img src="https://github.com/user-attachments/assets/81cdbc21-3b92-4116-b04c-4a746beb3e53" height="250">
</p>

<h1 align="center">
    Kryptonite ML Challenge 
    <br>
    –ö–æ–º–∞–Ω–¥–∞ MMG
</h1>

<br>

## üìù –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–®–∞–ø–∫–∞](#demo)
    - [–î–µ–º–æ](#demo)
    - [–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏](#description)
    - [–î–∞–Ω–Ω—ã–µ](#data)
    - [–°—Å—ã–ª–∫–∏](#links)
    - [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#tech-stack)
    <!-- - [–°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã]() -->
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#cloning)
    - [–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#cloning)
    - [–ó–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ](#container)
    - [–ó–∞–ø—É—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ](#local)
    - [–ò–Ω—Ñ–µ—Ä–µ–Ω—Å](#inference)
    - [–ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ](#inference-page)
    - [–û–±—É—á–µ–Ω–∏–µ](#training)
    - [–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ onnx](#onnx)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#project-structure)
    - [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#scaling)

<a id="demo"></a>
## üé• –î–µ–º–æ
<–≤–∏–¥–µ–æ-gif —Ç—É—Ç>

<a id="description"></a>
## üßê –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ DeepFake, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —É–≥—Ä–æ–∑—É –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏, —á—Ç–æ –∏—Ö —Å–ª–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç –Ω–∞—Å—Ç–æ—è—â–∏—Ö.

–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å:

* —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —á–µ–ª–æ–≤–µ–∫–∞
* —Ä–∞–∑–ª–∏—á–∞—Ç—å —Å–Ω–∏–º–∫–∏ —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π
* —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ñ–∞–ª—å—à–∏–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é DeepFake-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø—É—Ñ–∏–Ω–≥–∞

<a id="data"></a>
### üìÅ –î–∞–Ω–Ω—ã–µ
–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ –ø–∞–ø–∫–µ `data`. 

- **–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è**: [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://storage.codenrock.com/companies/codenrock-13/contests/kryptonite-ml-challenge/train.zip)
- **–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞**: [–°–∫–∞—á–∞—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ](https://storage.codenrock.com/companies/codenrock-13/contests/kryptonite-ml-challenge/test_public.zip)

<a id="links"></a>
## üîó –°—Å—ã–ª–∫–∏
–õ–µ–Ω–¥–∏–Ω–≥: [kryptonite-ml.ru](https://kryptonite-ml.ru)  
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: [git.codenrock.com/kryptonite-ml-challenge-1347](https://git.codenrock.com/kryptonite-ml-challenge-1347)  
–¢–µ—Å—Ç–∏—Ä—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞: [codenrock.com/contests/kryptonite-ml-challenge](https://codenrock.com/contests/kryptonite-ml-challenge/)

<a id="tech-stack"></a>
## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
!!! –¢–†–ï–ë–£–ï–¢–°–Ø –î–û–ü–û–õ–ù–ï–ù–ò–ï !!!
- **–°–∏—Å—Ç–µ–º–∞:** Ubuntu 22.04
- **–Ø–∑—ã–∫:** Python 3.12+
- **–§—Ä–µ–π–º–≤–æ—Ä–∫ –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è:** PyTorch
- **–≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏:** ONNX
- **–ò–Ω—Ñ–µ—Ä–µ–Ω—Å:** ONNX Runtime
- **–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏—Ü:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –º–æ–¥—É–ª—å
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:** PIL, NumPy, torchvision
- **CLI –∏ —É—Ç–∏–ª–∏—Ç—ã:** argparse, tqdm

<a id="cloning"></a>
## üìã –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```nushell
git clone https://github.com/kekwak/Kryptonite-ML-Challenge.git
cd Kryptonite-ML-Challenge
```

<a id="container"></a>
## üê≥ –ó–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
–°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º–æ–º—É:
```nushell
...
```
–∏–ª–∏ —Å–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑:
```nushell
...
```
–∞ —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –¥–æ–∫–µ—Ä—Ñ–∞–π–ª:
```nushell
...
```

<a id="local"></a>
## üñ• –ó–∞–ø—É—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–∞–∫–æ–Ω–¥–∞.  
* –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —ç—Ç–∏–º —Å–ø–æ—Å–æ–±–æ–º –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

```nushell
conda env create -f environment.yml && conda activate krypto
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126 --force-reinstall
pip3 install numpy==2.2.3
```

<a id="inference"></a>
## ü§ñ –ò–Ω—Ñ–µ—Ä–µ–Ω—Å

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å —Å –≥—É–≥–ª –¥–∏—Å–∫–∞. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--all`:
```nushell
python3 models/download_pretrained_models.py
```

–ü—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –ø–∞–ø–∫–µ **data**, –≤–æ—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
```nushell
data
‚îî‚îÄ‚îÄ test_public
   ‚îî‚îÄ‚îÄ images
       ‚îú‚îÄ‚îÄ 00000000
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ 1.jpg
       ‚îú‚îÄ‚îÄ 00000001
       ‚îÇ   ‚îú‚îÄ‚îÄ 0.jpg
       ‚îÇ   ‚îî‚îÄ‚îÄ 1.jpg
       ‚îú‚îÄ‚îÄ ...
       ...
```

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å—É. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:
```nushell
python3 scripts/inference.py --model models/onnx/ckpt_epoch1_batch20_acc0.9597_eer0.0282.onnx
```
–í –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å, –Ω–æ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥—É—é –ø–∞–ø–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Å –ø–æ–º–æ—â—å—é –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--input_dir data/path/to/images`.

*–í –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [aligner](https://huggingface.co/minchul/cvlface_DFA_resnet50) –¥–ª—è –æ–±—Ä–µ–∑–∞–Ω–∏—è –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

<a id="inference"></a>
## üåê –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ

–°–∫–∞—á–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –≥—É–≥–ª –¥–∏—Å–∫–∞:
```nushell
python3 models/download_pretrained_models.py --all
```

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `web` –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–µ—Ä–≤–µ—Ä:
```nushell
cd web && python3 -m uvicorn main:app --host 0.0.0.0
```
–í–µ–±-—Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –±—É–¥–µ—Ç –¥–ª—Å—Ç—É–ø–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ [0.0.0.0:8000](http://0.0.0.0:8000)

<a id="training"></a>
## üìö –û–±—É—á–µ–Ω–∏–µ

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –æ–±—É—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –≥—É–≥–ª –¥–∏—Å–∫–∞. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º `--all`:
```nushell
python3 models/download_pretrained_models.py --all
```
–£–∂–µ —Å–∫–∞—á–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è.

...

<a id="onnx"></a>
## üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ onnx

–î–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ onnx —Ñ–æ—Ä–º–∞—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É:
```nushell
python3 scripts/convert.py --checkpoint path/to/model.ckpt --output_model path/to/onnx_model.onnx
```

<a id="project-structure"></a>
## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```nushell
.
‚îú‚îÄ‚îÄ app
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
...
```

<a id="scaling"></a>
## üìà –ü–ª–∞–Ω—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö DeepFake –∏ FaceSwap –º–æ–¥–µ–ª–µ–π
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–º–æ—â—å—é —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
